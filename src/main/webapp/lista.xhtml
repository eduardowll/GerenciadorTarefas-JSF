<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core">
<h:head>
    <h:outputStylesheet library="css" name="estilos.css" />
    <title>Listagem de Tarefas</title>
</h:head>
<h:body>
    <h2>Listagem de Tarefas</h2>
    <h:form>
        <div class="filtros-box">
            <div class="filtros-row">
                <label for="numero">Número:</label>
                <h:inputText id="numero" value="#{listaBean.numeroFiltro}" />

                <label for="tituloDescricao">Título/Descrição:</label>
                <h:inputText id="tituloDescricao" value="#{listaBean.tituloDescricaoFiltro}" size="30" />
            </div>

            <div class="filtros-row">
                <label for="responsavel">Responsável:</label>
                <h:selectOneMenu id="responsavel" value="#{listaBean.responsavelIdFiltro}">
                    <f:selectItem itemLabel="Selecione" itemValue="#{null}" />
                    <f:selectItems value="#{listaBean.responsaveis}" var="r"
                                   itemLabel="#{r.nome}" itemValue="#{r.id}" />
                </h:selectOneMenu>

                <label for="status">Situação:</label>
                <h:selectOneMenu id="status" value="#{listaBean.statusFiltro}">
                    <f:selectItem itemLabel="Todas" itemValue="" />
                    <f:selectItem itemLabel="Em andamento" itemValue="Em andamento" />
                    <f:selectItem itemLabel="Concluído" itemValue="Concluído" />
                </h:selectOneMenu>
            </div>

            <div class="btn-group">
                <h:commandButton value="Buscar Tarefas" action="#{listaBean.buscarTarefas}" />
                <h:commandButton value="Limpar Filtros" action="#{listaBean.limparFiltros}" />
                <h:commandButton value="Nova Tarefa" action="cadastro.xhtml?faces-redirect=true" />
            </div>
        </div>
    </h:form>

    <h:dataTable value="#{listaBean.tarefasFiltradas}" var="t" styleClass="tabela-tarefas">

        <h:column>
            <f:facet name="header">Número</f:facet>
            #{t.id}
        </h:column>

        <h:column>
            <f:facet name="header">Título</f:facet>
            #{t.titulo}
        </h:column>

        <h:column>
            <f:facet name="header">Responsável</f:facet>
            #{t.responsavel.nome}
        </h:column>

        <h:column>
            <f:facet name="header"><b>Deadline</b></f:facet>
            <h:outputText value="#{t.deadline}">
                <f:convertDateTime pattern="dd/MM/yyyy"/>
            </h:outputText>
        </h:column>


        <h:column>
            <f:facet name="header">Ações</f:facet>
            <div class="acoes-cell">
                <h:form>
                    <h:commandButton value="Editar" action="#{listaBean.editar(t.id)}"
                                     styleClass="btn-editar" />
                </h:form>

                <h:form>
                    <h:commandButton value="Excluir" action="#{listaBean.excluir(t.id)}"
                                     styleClass="btn-excluir"
                                     onclick="return confirm('Tem certeza que deseja excluir?');" />
                </h:form>

                <h:form>
                    <h:commandButton value="Concluir" action="#{listaBean.concluir(t.id)}"
                                     styleClass="btn-concluir"
                                     rendered="#{t.status eq 'Em andamento'}" />
                </h:form>
            </div>
        </h:column>
    </h:dataTable>

    <!-- Mensagem quando não há tarefas -->
    <h:panelGroup rendered="#{empty listaBean.tarefasFiltradas}">
        <p><strong>Nenhuma tarefa encontrada com os filtros selecionados.</strong></p>
    </h:panelGroup>

</h:body>
</html>
